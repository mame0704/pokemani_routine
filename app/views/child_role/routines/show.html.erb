<div class="min-h-screen flex flex-col items-center justify-center bg-base-200 px-6 py-8">

  <!-- ルーティンタイトル -->
  <h1 class="text-3xl font-bold text-center text-base-content mb-6">
    <%= @routine.title %>
  </h1>

  <!-- ルーティン詳細 -->
  <div class="bg-white shadow-md rounded-2xl w-full max-w-md p-6 mb-6">
    <% if @routine.items.present? %>
      <ul class="list-disc pl-5 space-y-2">
        <% @routine.items.each do |item| %>
          <li class="text-lg text-base-content"><%= item %></li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-center text-gray-400">ルーティンの内容はまだ設定されていません</p>
    <% end %>
  </div>

  <!-- 実行ボタン -->
  <div class="w-full max-w-md">
    <% today_execution = @routine.routine_executions.find_by(executed_on: Date.current) %>
    <% latest_approval = today_execution&.routine_approvals&.order(created_at: :desc)&.first %>

    <% executed_today =
        if today_execution.nil?
          false
        elsif today_execution.completed?
          true
        elsif latest_approval&.rejected?
          false
        else
          true
        end %>

    <%= form_with model: [@routine, @routine.routine_executions.build],
                  url: child_role_routine_routine_executions_path(@routine),
                  local: true do |f| %>

      <%= f.submit "ルーティン実行",
                   class: "btn btn-primary btn-lg w-full rounded-2xl #{'btn-disabled' if executed_today}",
                   disabled: executed_today %>

      <%# メッセージ表示 %>
      <% if today_execution&.completed? %>
        <p class="text-center text-green-600 mt-2">
          今日のルーティンは承認済みです ✅
        </p>

      <% elsif latest_approval&.rejected? %>
        <p class="text-center text-red-500 mt-2">
          差し戻しされました。もう一度実行してください。
        </p>

      <% elsif today_execution.present? %>
        <p class="text-center text-gray-500 mt-2">
          現在、承認待ちです。
        </p>
      <% end %>

    <% end %>
  </div>

</div>
